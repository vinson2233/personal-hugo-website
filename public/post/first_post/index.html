<!doctype html>
<html ⚡ lang="en-us" [class]="darkMode ? 'dark-mode' : ''">
  <head>
    <meta charset="utf-8" />
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script>
    <script async custom-element="amp-bind" src="https://cdn.ampproject.org/v0/amp-bind-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>

    
    

    
    <title>Sklearn vs Numpy vs Numba speed comparison (Evaluation metric and building linear regression model)</title>

    
    



  
  
  <meta name="author" content="Vinson Ciawandy" />
  <meta name="description" content="Welcome to my first blog. Recently I started to develop my package, and my priorities are maximizing speed. I found many things in Sklearn that works quite slow. This is not a blog about tutorial using Sklearn, NumPy or Numba but this blog serves purpose for speed comparison across several libraries.
tldr, just skip to the conclusion part
 Photo by Nathan Salt from Pexels   Here’s my machine spec :">

  
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@gohugoio" />
    <meta name="twitter:title" content="Sklearn vs Numpy vs Numba speed comparison (Evaluation metric and building linear regression model)" />
    <meta name="twitter:description" content="Welcome to my first blog. Recently I started to develop my package, and my priorities are maximizing speed. I found many things in Sklearn that works quite slow. This is not a blog about tutorial using Sklearn, NumPy or Numba but this blog serves purpose for speed comparison across several libraries.
tldr, just skip to the conclusion part
 Photo by Nathan Salt from Pexels   Here’s my machine spec :" />
    <meta name="twitter:image" content="https://vinson2233.github.io/img/avatar.jpg" />
  




<meta name="generator" content="Hugo 0.80.0" />


<link rel="canonical" href="https://vinson2233.github.io/post/first_post/">
<link rel="alternative" href="/index.xml" title="Vinson Ciawandy" type="application/atom+xml">


<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="format-detection" content="telephone=no,email=no,adress=no" />


<meta name="robots" content="index,follow" />
<meta name="referrer" content="origin-when-cross-origin" />
<meta name="google-site-verification" content="google_site_verification_code" />
<meta name="msvalidate.01" content="bing_site_verification_code" />


<link rel="icon" href="/img/favicon.ico" />
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" sizes="120x120" href="/img/avatar.jpg">


<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400" rel="stylesheet">
<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom>:root{--main-bg-color:$main-background}:root .sunny{display:none}:root .moon{display:block}.dark-mode:root{--main-bg-color:#000}.dark-mode:root .sunny{display:block}.dark-mode:root .moon{display:none}/*! normalize.css v7.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}body{font-size:18px;font-weight:300;line-height:1.618;font-family:Roboto,sans-serif;color:#777;background-color:var(--main-bg-color);text-rendering:optimizeLegibility;-webkit-overflow-scrolling:touch}a{color:#3f9adc;text-decoration:none;font-weight:600}a:focus,a:hover{opacity:.7;outline:none}amp-img{margin:0 auto;box-shadow:2px 20px 40px 10px rgba(0,0,0,.15)}button:hover{cursor:pointer}.main{padding:1rem 2rem;box-sizing:border-box}@media screen and (max-width:800px){.main{margin-left:0;padding:0 1rem 1rem;border:1px solid #ddd;border-right:none;border-left:none}}.footer{display:block;padding:1rem;font-size:.8rem;text-align:center;font-family:Roboto Mono,Menlo,Monaco,Consolas,Courier New,monospace}.wrapper{display:grid;grid-gap:20px;min-height:100vh}@media screen and (max-width:640px){.wrapper{grid-template-rows:100px 1fr 90px;grid-template-areas:"header" "main" "footer"}}@media screen and (min-width:640px){.wrapper{grid-template-columns:320px 1fr;grid-template-rows:1fr 90px;grid-template-areas:"header main" "header footer"}}.header{grid-area:header}.main{grid-area:main}.footer{grid-area:footer}.icon{font-style:normal;text-decoration:inherit;width:1em;height:1em;font-variant:normal;text-transform:none;line-height:1em}.icon,.share{display:inline-block;text-align:center}.share{font-weight:400;margin-left:.2rem;border:none;outline:none;color:#fff;width:30px;height:30px;border-radius:50%}.share-twitter{background-color:#55acee}.share-twitter-icon{margin:5px 0 0 1px}.share-facebook{background-color:#3b5998}.header{padding:1rem;box-sizing:border-box;text-align:center;background-color:rgba(106,172,14,.9)}.logo{margin-top:3rem;border-radius:20%;border:4px solid #fff;transition:all .5s ease-out}.logo:hover{border-radius:50%;box-shadow:0 1px 4px rgba(0,0,0,.3)}@media screen and (max-width:800px){.logo{position:absolute;top:1rem;left:1rem;width:2rem;height:2rem;margin-top:0;border:2px solid #fff}}.title{font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:600;margin:1rem auto}@media screen and (max-width:800px){.title{margin:0 auto}}.subtitle,.title a{color:#fff}.subtitle{margin-bottom:1rem;opacity:.8}.menu{display:none}@media screen and (min-width:800px){.menu{display:block}}.menu-list{list-style:none;padding:0}.menu-item{padding:1rem 0}.menu-item a{font-weight:100;opacity:.8;color:#fff}.menu-item a:focus,.menu-item a:hover{opacity:1}.menu-item.is-active a{color:#444;opacity:1;font-weight:700}.menu-toggle{border:none;outline:none;font-size:2rem;background-color:transparent;color:#fff;position:absolute;top:1rem;right:1rem}@media screen and (min-width:800px){.menu-toggle{display:none}}.sidebar{background-color:#fff;width:100vw}@media screen and (min-width:640px){.sidebar{width:50vw}}.sidebar-list{list-style:none;padding:0;margin:0}.sidebar-menu{text-align:right;padding:16px}.sidebar-item{font-size:2rem;padding:30px 35px 30px 25px;border-top:1px solid #ddd}.sidebar-item:hover{background-color:#f2f2f2}.sidebar-icon{border:none;outline:none;background-color:transparent;font-family:Roboto,sans-serif;font-weight:100;font-size:2rem}.sidebar-link{color:#000;font-weight:100}.social-list{margin:0;padding:0;list-style:none}.social-item{display:inline-block;margin:0 .2rem}.social-item a{color:#fff;font-weight:400}@media screen and (max-width:800px){.entry-list{padding-top:30px}}.entry-single{line-height:1.8;margin-bottom:22px;background-color:#fff;box-shadow:0 0 2px 0 rgba(137,146,177,.15),0 3px 10px 0 rgba(137,146,177,.1);border-radius:5px}.entry-single:hover{box-shadow:0 1px 15px 0 rgba(137,146,177,.15),0 10px 20px 0 rgba(137,146,177,.15)}.entry-cover{max-width:100%;border-radius:5px 5px 0 0;-o-object-fit:cover;object-fit:cover;box-shadow:none}.entry-title{margin:0;padding:20px 30px 0}.entry-link{font-size:1.5rem;font-weight:600;color:#262626}.entry-summary{padding:0 30px;text-align:justify;max-height:4rem;overflow:hidden}.entry-footer{margin:0 30px;padding:10px 0;border-top:1px solid #ddd;display:flex;justify-content:space-between}.entry-meta{margin:0;font-size:.8rem;letter-spacing:1px;text-transform:uppercase}.entry-time{color:#444}.entry-time:after{content:"";border-right:1px solid #ddd;margin:0 8px 0 10px}.pagination{display:flex;justify-content:flex-start}.pagination-btn{color:#777;padding:.8rem;background-color:#fff;border:1px solid #ddd;font-size:.8rem;text-transform:uppercase;border-radius:5px}.pagination-btn:focus,.pagination-btn:hover{color:#fff;background-color:#6aac0e;border-color:#6aac0e}.pagination-next{margin-left:auto}.post-header:after{display:block;content:"";width:60px;padding-top:10px;border-bottom:3px solid #6aac0e}.post-title{font-size:2rem;color:#262626;line-height:1.5;margin-top:1.5rem;margin-bottom:.5rem}.post-footer{margin:1rem 0;line-height:1.8}.post-tags{margin-top:0;margin-bottom:1rem;padding-left:0}.post-tag{display:inline-block;margin:0 .5rem 0 0;border-radius:3px;padding:5px 10px;background:#f2f2f2;font-size:.8rem}.post-tag:hover{background:#ddd;box-shadow:0 1px 15px 0 rgba(137,146,177,.15),0 10px 20px 0 rgba(137,146,177,.15)}.post-content{line-height:1.8}.post-content h1,.post-content h2,.post-content h3,.post-content h4,.post-content h5,.post-content h6{color:#6cb505;font-weight:700;line-height:1.125}.post-content h1{margin-top:2rem;margin-bottom:1rem;font-size:2rem}.post-content h2{margin-top:1.75rem;margin-bottom:.75rem;font-size:1.5rem}.post-content h3{margin-top:1.5rem;margin-bottom:.5rem;font-size:1.25rem}.post-content h4{margin-top:1.25rem;margin-bottom:.25rem;font-size:1rem}.post-content h5,.post-content h6{margin-top:1rem;margin-bottom:0;font-size:.8rem}.post-content li+li{margin-top:.5rem}.post-content em{color:#777;font-style:italic}.post-content strong{color:#444}.post-content del{color:#777;text-decoration:line-through}.post-content ins{color:#444;text-decoration:underline}.post-content hr{position:relative;margin:2rem auto;border-top:1px dashed #ddd;border-bottom:none}.post-content hr:before{content:"sep line";position:absolute;top:-12px;left:calc(50% - 40px);padding:0 .5rem;background-color:#fff;color:#ddd;font-size:.8rem;font-family:Roboto Mono,Menlo,Monaco,Consolas,Courier New,monospace}.post-content p{margin-top:1.5rem;margin-bottom:1.5rem;text-align:justify}.post-content blockquote{background-color:#f2f2f2;border-left:5px solid #ddd;padding:.5rem 1rem;margin:2rem 0}.post-content blockquote p{margin-top:.5rem;margin-bottom:.5rem}.post-content blockquote cite{margin-top:1.5rem;color:#777;font-size:.9rem}.post-content code,.post-content tt{padding:.2em 0;margin:0;font-size:.9em;background-color:#ddd;font-family:Roboto Mono,Menlo,Monaco,Consolas,Courier New,monospace}.post-content code:after,.post-content code:before,.post-content tt:after,.post-content tt:before{letter-spacing:-.2em;content:"\00a0"}.post-content kbd{display:inline-block;padding:.25em;background-color:#f2f2f2;border:1px solid #ddd;border-radius:3px;box-shadow:inset 0 -1px 0 rgba(0,0,0,.05);font-size:.8em;line-height:1.25;font-family:Roboto Mono,Menlo,Monaco,Consolas,Courier New,monospace;color:#777}.post-content pre{margin:2rem auto;padding:1rem;overflow-x:auto;border-radius:3px;font-size:.9rem;line-height:1.618;white-space:pre;word-wrap:normal;word-break:normal;background:#ddd;color:#777}.post-content pre code{font-size:.9rem;background-color:transparent}.post-content pre code:after,.post-content pre code:before{content:none}.post-content sub,.post-content sup{font-size:.8rem}.post-content sub a,.post-content sub a:focus,.post-content sub a:hover,.post-content sup a,.post-content sup a:focus,.post-content sup a:hover{border-bottom:none}.post-content ol{margin-left:0;margin-top:2rem;margin-bottom:2rem;padding-left:1.5rem;list-style:decimal outside}.post-content ol ol{margin-top:.5rem;margin-bottom:.5rem;list-style:lower-roman outside}.post-content ol ul{margin-top:.5rem;margin-bottom:.5rem;list-style:disc outside}.post-content ul{margin-left:0;margin-top:2rem;margin-bottom:2rem;padding-left:1.5rem;list-style:disc outside}.post-content ul ul{margin-top:.5rem;margin-bottom:.5rem;list-style:circle outside}.post-content ul ol{margin-top:.5rem;margin-bottom:.5rem;list-style:decimal outside}.post-content dl{margin-top:2rem;margin-bottom:2rem}.post-content dl dt{color:#6aac0e;margin-top:1rem}.post-content dl dt:after{content:":"}.post-content dl dd{text-indent:2rem;margin-left:0;margin-top:.25rem}.post-content figure{display:block;margin:2rem auto}.post-content figure img{max-width:100%;box-shadow:2px 20px 40px 10px rgba(0,0,0,.15)}@media screen and (max-width:800px){.post-content figure img{box-shadow:none}}.post-content figure figcaption h4{color:#ddd;font-size:.9rem;text-align:center}table{background-color:#f2f2f2;color:#444;margin:2rem auto;width:100%;border-collapse:collapse;border-radius:5px}table td,table th{border:solid #ddd;border-width:0 0 1px;padding:.5em .75em;vertical-align:center}table th{color:#444}table tr:hover{background-color:#ddd}table thead td,table thead th{border-width:0 0 2px;color:#777}table tfoot td,table tfoot th{border-width:2px 0 0;color:#777}table tbody tr:last-child td,table tbody tr:last-child th{border-bottom-width:0}table tr:first-child th:first-child{border-top-left-radius:5px}table tr:first-child th:last-child{border-top-right-radius:5px}table tr:last-child td:first-child{border-bottom-left-radius:5px}table tr:last-child td:last-child{border-bottom-right-radius:5px}.not-found{margin:5rem auto 0;font-family:Roboto Mono,Menlo,Monaco,Consolas,Courier New,monospace;text-align:center}.error-emoji{color:#444;font-size:3rem}.error-text{font-size:1.25rem}.error-link{margin-top:2rem;font-size:1rem;color:#6aac0e}</style>

  </head>
  <body class="wrapper">
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="icon-menu" viewBox="0 0 640 640">
    <path d="M0 96h640v64h-640v-64zM0 288h640v64h-640v-64zM0 480h640v64h-640v-64z" />
  </symbol>

  <symbol id="icon-rss" viewBox="0 0 24 24">
    <path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z" />
  </symbol>

  <symbol id="icon-sunny" viewBox="0 0 64 64">
    <path fill="none" stroke="#202020" stroke-miterlimit="10" stroke-width="2" d="M32 2v16m0 28v16m30-30H46m-28 0H2m8.8-21.2l11.3 11.3m19.8 19.8l11.3 11.3m0-42.4L41.9 22.1M22.1 41.9L10.8 53.2" stroke-linejoin="round" stroke-linecap="round" />
    <circle cx="32" cy="32" r="14" fill="none" stroke="#202020" stroke-miterlimit="10" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" />
  </symbol>

  <symbol id="icon-moon" viewBox="0 0 64 64">
    <path d="M35 2a25 25 0 0 1-22 36.8 24.9 24.9 0 0 1-10.6-2.3A30 30 0 1 0 35 2z"
    fill="none" stroke="#202020" stroke-miterlimit="10" stroke-width="2" stroke-linejoin="round"
    stroke-linecap="round" />
  </symbol>

  <symbol id="icon-email" viewBox="0 0 24 24">
    <path d="M24 4.5v15c0 .85-.65 1.5-1.5 1.5H21V7.387l-9 6.463-9-6.463V21H1.5C.649 21 0 20.35 0 19.5v-15c0-.425.162-.8.431-1.068C.7 3.16 1.076 3 1.5 3H2l10 7.25L22 3h.5c.425 0 .8.162 1.069.432.27.268.431.643.431 1.068z" />
  </symbol>

  <symbol id="icon-twitter" viewBox="0 0 24 24">
    <path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z" />
  </symbol>

  <symbol id="icon-github" viewBox="0 0 24 24">
    <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" />
  </symbol>

  <symbol id="icon-dribbble" viewBox="0 0 24 24">
    <path d="M12 24C5.385 24 0 18.615 0 12S5.385 0 12 0s12 5.385 12 12-5.385 12-12 12zm10.12-10.358c-.35-.11-3.17-.953-6.384-.438 1.34 3.684 1.887 6.684 1.992 7.308 2.3-1.555 3.936-4.02 4.395-6.87zm-6.115 7.808c-.153-.9-.75-4.032-2.19-7.77l-.066.02c-5.79 2.015-7.86 6.025-8.04 6.4 1.73 1.358 3.92 2.166 6.29 2.166 1.42 0 2.77-.29 4-.814zm-11.62-2.58c.232-.4 3.045-5.055 8.332-6.765.135-.045.27-.084.405-.12-.26-.585-.54-1.167-.832-1.74C7.17 11.775 2.206 11.71 1.756 11.7l-.004.312c0 2.633.998 5.037 2.634 6.855zm-2.42-8.955c.46.008 4.683.026 9.477-1.248-1.698-3.018-3.53-5.558-3.8-5.928-2.868 1.35-5.01 3.99-5.676 7.17zM9.6 2.052c.282.38 2.145 2.914 3.822 6 3.645-1.365 5.19-3.44 5.373-3.702-1.81-1.61-4.19-2.586-6.795-2.586-.825 0-1.63.1-2.4.285zm10.335 3.483c-.218.29-1.935 2.493-5.724 4.04.24.49.47.985.68 1.486.08.18.15.36.22.53 3.41-.43 6.8.26 7.14.33-.02-2.42-.88-4.64-2.31-6.38z" />
  </symbol>

  <symbol id="icon-linkedin" viewBox="0 0 24 24">
    <title>LinkedIn</title>
    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
  </symbol>

  <symbol id="icon-facebook" viewBox="0 0 60 60">
    <path d="M42.8,23.8h-7.4v-4.8c0-1.8,1.2-2.2,2.1-2.2c0.8,0,5.2,0,5.2, 0v-8l-7.2,0c-8,0-9.8,6-9.8,9.8v5.3 h-4.6V32h4.6c0,10.6,0,23.3,0,23.3h9.7c0,0,0-12.9,0-23.3H42L42.8,23.8z" />
  </symbol>

  <symbol id="icon-instagram" viewBox="0 0 24 24">
    <path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z" />
  </symbol>

  <symbol id="icon-youtube" viewBox="0 0 24 24">
    <path class="a" d="M23.495 6.205a3.007 3.007 0 0 0-2.088-2.088c-1.87-.501-9.396-.501-9.396-.501s-7.507-.01-9.396.501A3.007 3.007 0 0 0 .527 6.205a31.247 31.247 0 0 0-.522 5.805 31.247 31.247 0 0 0 .522 5.783 3.007 3.007 0 0 0 2.088 2.088c1.868.502 9.396.502 9.396.502s7.506 0 9.396-.502a3.007 3.007 0 0 0 2.088-2.088 31.247 31.247 0 0 0 .5-5.783 31.247 31.247 0 0 0-.5-5.805zM9.609 15.601V8.408l6.264 3.602z" />
  </symbol>

  <symbol id="icon-pinterest" viewBox="0 0 24 24">
    <path d="M8.134 18.748c0-1.6.2-3 .8-4.4.5-1.4 1.2-2.6 2.2-3.6.9-1 2-1.9 3.2-2.6 1.2-.8 2.5-1.3 3.9-1.7 1.5-.4 2.9-.5 4.4-.5 2.2 0 4.3.4 6.2 1.4 1.9.9 3.5 2.3 4.7 4.1 1.2 1.9 1.8 3.9 1.8 6.2 0 1.4-.1 2.7-.4 4-.2 1.3-.7 2.6-1.2 3.8-.6 1.2-1.3 2.3-2.2 3.2-.8.9-1.8 1.7-3.1 2.2-1.2.6-2.5.9-4 .9-1 0-1.9-.3-2.9-.7-.9-.5-1.6-1.1-2-1.9-.1.5-.3 1.4-.6 2.4-.3 1.1-.4 1.7-.5 2-.1.3-.2.9-.4 1.6-.3.7-.4 1.2-.6 1.5-.1.3-.4.7-.7 1.3-.3.6-.6 1.2-1 1.7-.3.5-.7 1.1-1.3 1.8l-.3.1-.2-.2c-.2-2.2-.3-3.6-.3-4 0-1.3.2-2.8.5-4.4.3-1.7.8-3.7 1.4-6.2.6-2.5 1-3.9 1.1-4.4-.5-.9-.7-2.1-.7-3.6 0-1.2.4-2.3 1.1-3.3.8-1.1 1.7-1.6 2.8-1.6.9 0 1.6.3 2.1.9.4.6.7 1.3.7 2.2 0 .9-.3 2.3-1 4.1-.6 1.8-.9 3.1-.9 4 0 .9.3 1.6 1 2.2.6.6 1.4.9 2.3.9.8 0 1.5-.2 2.2-.5.6-.4 1.2-.9 1.6-1.5.5-.6.9-1.3 1.2-2 .4-.8.6-1.5.8-2.4.2-.8.4-1.6.5-2.4.1-.7.1-1.4.1-2.1 0-2.5-.8-4.4-2.3-5.8-1.6-1.4-3.6-2.1-6.1-2.1-2.8 0-5.2 1-7.1 2.8-1.9 1.9-2.9 4.2-2.9 7.1 0 .6.1 1.2.3 1.8.2.6.4 1.1.6 1.4.2.3.4.7.5 1 .2.3.3.5.3.6 0 .4-.1.9-.3 1.6-.2.6-.5 1-.8 1 0 0-.1-.1-.4-.1-.7-.2-1.3-.6-1.9-1.2-.5-.6-1-1.3-1.3-2-.3-.8-.5-1.6-.7-2.4-.2-.7-.2-1.5-.2-2.2z" />
  </symbol>

  <symbol id="icon-reddit" viewBox="0 0 24 24">
    <title>Reddit icon</title>
    <path d="M2.204 14.049c-.06.276-.091.56-.091.847 0 3.443 4.402 6.249 9.814 6.249 5.41 0 9.812-2.804 9.812-6.249 0-.274-.029-.546-.082-.809l-.015-.032c-.021-.055-.029-.11-.029-.165-.302-1.175-1.117-2.241-2.296-3.103-.045-.016-.088-.039-.126-.07-.026-.02-.045-.042-.067-.064-1.792-1.234-4.356-2.008-7.196-2.008-2.815 0-5.354.759-7.146 1.971-.014.018-.029.033-.049.049-.039.033-.084.06-.13.075-1.206.862-2.042 1.937-2.354 3.123 0 .058-.014.114-.037.171l-.008.015zm9.773 5.441c-1.794 0-3.057-.389-3.863-1.197-.173-.174-.173-.457 0-.632.176-.165.46-.165.635 0 .63.629 1.685.943 3.228.943 1.542 0 2.591-.3 3.219-.929.165-.164.45-.164.629 0 .165.18.165.465 0 .645-.809.808-2.065 1.198-3.862 1.198l.014-.028zm-3.606-7.573c-.914 0-1.677.765-1.677 1.677 0 .91.763 1.65 1.677 1.65s1.651-.74 1.651-1.65c0-.912-.739-1.677-1.651-1.677zm7.233 0c-.914 0-1.678.765-1.678 1.677 0 .91.764 1.65 1.678 1.65s1.651-.74 1.651-1.65c0-.912-.739-1.677-1.651-1.677zm4.548-1.595c1.037.833 1.8 1.821 2.189 2.904.45-.336.719-.864.719-1.449 0-1.002-.815-1.816-1.818-1.816-.399 0-.778.129-1.09.363v-.002zM2.711 9.963c-1.003 0-1.817.816-1.817 1.818 0 .543.239 1.048.644 1.389.401-1.079 1.172-2.053 2.213-2.876-.302-.21-.663-.329-1.039-.329v-.002zm9.217 12.079c-5.906 0-10.709-3.205-10.709-7.142 0-.275.023-.544.068-.809C.494 13.598 0 12.729 0 11.777c0-1.496 1.227-2.713 2.725-2.713.674 0 1.303.246 1.797.682 1.856-1.191 4.357-1.941 7.112-1.992l1.812-5.524.404.095s.016 0 .016.002l4.223.993c.344-.798 1.138-1.36 2.065-1.36 1.229 0 2.231 1.004 2.231 2.234 0 1.232-1.003 2.234-2.231 2.234s-2.23-1.004-2.23-2.23l-3.851-.912-1.467 4.477c2.65.105 5.047.854 6.844 2.021.494-.464 1.144-.719 1.833-.719 1.498 0 2.718 1.213 2.718 2.711 0 .987-.54 1.886-1.378 2.365.029.255.059.494.059.749-.015 3.938-4.806 7.143-10.72 7.143l-.034.009zm8.179-19.187c-.74 0-1.34.599-1.34 1.338 0 .738.6 1.34 1.34 1.34.732 0 1.33-.6 1.33-1.334 0-.733-.598-1.332-1.347-1.332l.017-.012z"/>
  </symbol>
</svg>

    <header class="header">
  <amp-img alt="Vinson Ciawandy"
    width="128px"
    height="128px"
    class="logo"
    src="/img/profile-picture.png"
    sizes="(max-width: 800px) 36px, 128px">
  </amp-img>
  
    <h2 class="title"><a href="https://vinson2233.github.io/" title="Vinson Ciawandy">Vinson Ciawandy</a></h2>
  
  <p class="subtitle">Data Science | Python | Mathematics</p>
  <button class="menu-toggle" type="button" on="tap:sidebar.open">
    <svg class="icon icon-menu" fill="currentColor"><use xlink:href="#icon-menu" /></svg>
  </button>

  
  <nav class="menu">
    <ul class="menu-list">
      



  <li class="sidebar-item "><a class="sidebar-link" href="/">Home</a></li>

  <li class="sidebar-item "><a class="sidebar-link" href="/about/">About Me</a></li>

  <li class="sidebar-item "><a class="sidebar-link" href="/tags/">Tags</a></li>


    </ul>
  </nav>

  <button on="tap:AMP.setState({darkMode: !darkMode})">
    <svg class="icon moon" fill="currentColor"><use xlink:href="#icon-moon" /></svg>
    <svg class="icon sunny" fill="currentColor"><use xlink:href="#icon-sunny" /></svg>
  </button>

  <ul class="social-list">
  
  <li class="social-item">
    <a href="mailto:vinsonciawandy@gmail.com" title="Email">
      <svg class="icon" fill="currentColor"><use xlink:href="#icon-email" /></svg>
    </a>
  </li>
  

  
  <li class="social-item">
    <a href="//github.com/vinson2233" title="GitHub">
      <svg class="icon" fill="currentColor"><use xlink:href="#icon-github" /></svg>
    </a>
  </li>
  

  

  
  <li class="social-item">
    <a href="//www.linkedin.com/in/vinsonciawandy" title="Linkedin">
      <svg class="icon" fill="currentColor"><use xlink:href="#icon-linkedin" /></svg>
    </a>
  </li>
  

  

  

  

  

  

  

  <li class="social-item">
    <a href="/index.xml" title="RSS">
      <svg class="icon" fill="currentColor"><use xlink:href="#icon-rss" /></svg>
    </a>
  </li>
</ul>

</header>

    <amp-sidebar id="sidebar" class="sidebar" layout="nodisplay" side="right">
  <ul class="sidebar-list">
    <li class="sidebar-menu"><button class="sidebar-icon" on="tap:sidebar.close">X</button></li>
    



  <li class="sidebar-item "><a class="sidebar-link" href="/">Home</a></li>

  <li class="sidebar-item "><a class="sidebar-link" href="/about/">About Me</a></li>

  <li class="sidebar-item "><a class="sidebar-link" href="/tags/">Tags</a></li>


  </ul>
</amp-sidebar>

    
  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">Sklearn vs Numpy vs Numba speed comparison (Evaluation metric and building linear regression model)</h1>
      <p class="entry-meta"><span class="entry-time">Feb 20, 2021</span> 6 min read</p>
    </header>
    

    <article class="post-content"><p>Welcome to my first blog. Recently I started to develop my package, and my priorities are maximizing speed. I found many things in Sklearn that works quite slow. This is not a blog about tutorial using Sklearn, NumPy or Numba but this blog serves purpose for speed comparison across several libraries.<br>
tldr, just skip to the <a href="#conclusion">conclusion part</a></p>


    <div align="center">
        <img src="https://ik.imagekit.io/pwhcix71iqy/front_2021-02-20_fvBnTirhh4Q.jpg" width="30%"> </img>
        <figcaption>Photo by 
            <a href = "https://www.pexels.com/@nathansalt?utm_content=attributionCopyText&utm_medium=referral utm_source=pexels">Nathan Salt</a> from 
            <a href = "https://www.pexels.com/photo/photo-of-man-riding-red-motor-scooter-2549355/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels">Pexels</a>
        </figcaption>
    </div>

<p>Here’s my machine spec :</p>
<ul>
<li>CPU : Ryzen 3500U</li>
<li>RAM : 6 GB</li>
<li>OS : Windows 10</li>
</ul>
<p>My software :</p>
<ul>
<li>Python : 3.8.5</li>
<li>numpy : 1.18.5</li>
<li>scikit-learn : 0.23.2</li>
<li>numba : 0.50.1</li>
</ul>
<p>For evaluation, i use magic function %timeit and %memit to measure runtime speed and the memory taken by the process.
%timeit work out of the box, but for using memit, we need to install memory_profiler and load it first.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Run this inside jupyterlab/notebook cell</span>
<span style="color:#960050;background-color:#1e0010">!</span>pip install memory_profiler
<span style="color:#f92672">%</span>load_ext memory_profiler
</code></pre></div><h1 id="1-binary-classification-evaluation">1. Binary Classification Evaluation</h1>
<p>The first section is evaluating those packages in evaluating binary classification results. Here’s the dummy data i generated by uniform distribution with length 1000000</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">from</span> numpy.random <span style="color:#f92672">import</span> uniform
size <span style="color:#f92672">=</span> <span style="color:#ae81ff">500000</span>
n_positive <span style="color:#f92672">=</span> int(size<span style="color:#f92672">*</span><span style="color:#ae81ff">0.8</span>) 
n_negative <span style="color:#f92672">=</span> int(size<span style="color:#f92672">*</span><span style="color:#ae81ff">1.2</span>)
actual <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span>n_negative <span style="color:#f92672">+</span> [<span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>n_positive)
pred <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>append(uniform(<span style="color:#ae81ff">0.2</span>,<span style="color:#ae81ff">0.6</span>,n_negative ),uniform(<span style="color:#ae81ff">0.4</span>,<span style="color:#ae81ff">0.8</span>,size))
</code></pre></div><h2 id="11-logloss-calculation">1.1 Logloss calculation</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> log_loss <span style="color:#66d9ef">as</span> logloss_sklearn
 
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">logloss_numpy</span>(actual,pred):
     <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>mean(actual<span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>log(pred) <span style="color:#f92672">+</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>actual)<span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>log(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>pred))
 
<span style="color:#f92672">from</span> numba <span style="color:#f92672">import</span> jit
<span style="color:#a6e22e">@jit</span>(nopython<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">logloss_numba</span>(actual,pred):
     logloss <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
     <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(actual<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]):  
         logloss <span style="color:#f92672">+=</span> actual[i]<span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>log(pred[i]) <span style="color:#f92672">+</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>actual[i])<span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>log(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>pred[i])
     <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>logloss<span style="color:#f92672">/</span>actual<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span>timeit logloss_sklearn(actual,pred)
<span style="color:#f92672">%</span>timeit logloss_numpy(actual,pred)
<span style="color:#f92672">%</span>timeit logloss_numba(actual,pred)
 
<span style="color:#f92672">%</span>memit logloss_sklearn(actual,pred)
<span style="color:#f92672">%</span>memit logloss_numpy(actual,pred)
<span style="color:#f92672">%</span>memit logloss_numba(actual,pred)
</code></pre></div><table>
<thead>
<tr>
<th>Method</th>
<th style="text-align:center">Time</th>
<th style="text-align:right">Memory Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sklearn</td>
<td style="text-align:center">227 ms ± 7.52 ms</td>
<td style="text-align:right">peak : 260.78 MiB, increment: 41.03 MiB</td>
</tr>
<tr>
<td>Numpy</td>
<td style="text-align:center">36.8 ms ± 1.25 ms</td>
<td style="text-align:right">peak : 244.09 MiB, increment: 23.61 MiB</td>
</tr>
<tr>
<td>Numba</td>
<td style="text-align:center">16.9 ms ± 1.32 ms</td>
<td style="text-align:right">peak : 220.52 MiB, increment: 0.01 MiB</td>
</tr>
</tbody>
</table>
<h2 id="12-confusion-matrix">1.2 Confusion Matrix</h2>
<p>The following code cited from this <a href="https://stackoverflow.com/questions/2148543/how-to-write-a-confusion-matrix-in-python/30385488">stackoverflow</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> confusion_matrix <span style="color:#66d9ef">as</span> CM_sklearn
 
<span style="color:#a6e22e">@jit</span>(nopython<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">CM_numba</span>(true, pred):
    <span style="color:#75715e">#by cgnorthcutt</span>
    K <span style="color:#f92672">=</span> len(np<span style="color:#f92672">.</span>unique(true))
    result <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros((K, K))
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(true)):
        result[true[i]][pred[i]] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">return</span> result
 
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">CM_numpy</span>(true,pred):
    <span style="color:#75715e">#by rytido</span>
    classes <span style="color:#f92672">=</span> len(np<span style="color:#f92672">.</span>unique(true))
    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>bincount(true <span style="color:#f92672">*</span> classes <span style="color:#f92672">+</span> pred)<span style="color:#f92672">.</span>reshape((classes, classes))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span>timeit CM_sklearn(actual,pred_class)
<span style="color:#f92672">%</span>timeit CM_numpy(actual,pred_class)
<span style="color:#f92672">%</span>timeit CM_numba(actual,pred_class)
 
<span style="color:#f92672">%</span>memit CM_sklearn(actual,pred_class)
<span style="color:#f92672">%</span>memit CM_numpy(actual,pred_class)
<span style="color:#f92672">%</span>memit CM_numba(actual,pred_class)
</code></pre></div><table>
<thead>
<tr>
<th>Method</th>
<th style="text-align:center">Time</th>
<th style="text-align:right">Memory Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sklearn</td>
<td style="text-align:center">888 ms ± 27.2 ms</td>
<td style="text-align:right">peak : 248.26 MiB, increment: 18.79 MiB</td>
</tr>
<tr>
<td>Numpy</td>
<td style="text-align:center">27.5 ms ± 1.61 ms</td>
<td style="text-align:right">peak : 240.56 MiB, increment: 12.42 MiB</td>
</tr>
<tr>
<td>Numba</td>
<td style="text-align:center">34.3 ms ± 1.58 ms</td>
<td style="text-align:right">peak : 232.95 MiB, increment: 3.83 MiB</td>
</tr>
</tbody>
</table>
<h2 id="13-roc-auc-score">1.3 ROC-AUC score</h2>
<p>The code cited from <a href="https://www.kaggle.com/c/microsoft-malware-prediction/discussion/76013">https://www.kaggle.com/c/microsoft-malware-prediction/discussion/76013</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> roc_auc_score <span style="color:#66d9ef">as</span> rocauc_sklearn
 
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rocauc_numpy</span>(y_true, y_prob):
    <span style="color:#75715e">#This function basically same with rocauc_numba</span>
    <span style="color:#75715e">#I want to see if numpy natural vectorization is faster than numba</span>
    y_true <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>asarray(y_true, dtype<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>float64)
    y_true <span style="color:#f92672">=</span> y_true[np<span style="color:#f92672">.</span>argsort(y_prob)]
    n <span style="color:#f92672">=</span> len(y_true)
    nfalse <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>y_true)<span style="color:#f92672">.</span>cumsum()
    auc <span style="color:#f92672">=</span> (y_true<span style="color:#f92672">*</span>nfalse)<span style="color:#f92672">.</span>sum()
    last_nfalse <span style="color:#f92672">=</span> nfalse[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
    auc <span style="color:#f92672">/=</span> (last_nfalse<span style="color:#f92672">*</span> (n <span style="color:#f92672">-</span> last_nfalse))
    <span style="color:#66d9ef">return</span> auc
 
<span style="color:#f92672">from</span> numba <span style="color:#f92672">import</span> jit
<span style="color:#a6e22e">@jit</span>(nopython<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rocauc_numba</span>(y_true, y_prob):
    y_true <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>asarray(y_true)
    y_true <span style="color:#f92672">=</span> y_true[np<span style="color:#f92672">.</span>argsort(y_prob)]
    nfalse <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    auc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    n <span style="color:#f92672">=</span> len(y_true)
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n):
        y_i <span style="color:#f92672">=</span> y_true[i]
        nfalse <span style="color:#f92672">+=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> y_i)
        auc <span style="color:#f92672">+=</span> y_i <span style="color:#f92672">*</span> nfalse
    auc <span style="color:#f92672">/=</span> (nfalse <span style="color:#f92672">*</span> (n <span style="color:#f92672">-</span> nfalse))
    <span style="color:#66d9ef">return</span> auc
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span>timeit rocauc_sklearn(actual,pred)
<span style="color:#f92672">%</span>timeit rocauc_numpy(actual, pred)
<span style="color:#f92672">%</span>timeit rocauc_numba(actual, pred)
 
<span style="color:#f92672">%</span>memit rocauc_sklearn(actual,pred)
<span style="color:#f92672">%</span>memit rocauc_numpy(actual, pred)
<span style="color:#f92672">%</span>memit rocauc_numba(actual, pred)
</code></pre></div><table>
<thead>
<tr>
<th>Method</th>
<th style="text-align:center">Time</th>
<th style="text-align:right">Memory Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sklearn</td>
<td style="text-align:center">752 ms ± 33.4 ms</td>
<td style="text-align:right">peak : 298.05 MiB, increment: 46.12 MiB</td>
</tr>
<tr>
<td>Numpy</td>
<td style="text-align:center">282 ms ± 25.4 ms</td>
<td style="text-align:right">peak : 258.04 MiB, increment: 15.32 MiB</td>
</tr>
<tr>
<td>Numba</td>
<td style="text-align:center">358 ms ± 42.7 ms</td>
<td style="text-align:right">peak : 250.51 MiB, increment: 7.72 MiB</td>
</tr>
</tbody>
</table>
<h1 id="2regression-evaluation">2.Regression Evaluation</h1>
<p>The second section is evaluating those libraries on evaluation regression metric.</p>
<h2 id="21-root-mean-squared-error">2.1 Root Mean Squared Error</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> mean_squared_error <span style="color:#66d9ef">as</span> RMSE_sklearn
 
<span style="color:#a6e22e">@jit</span>(nopython<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">RMSE_numba</span>(actual,pred):
    Squared_Error <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(actual<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]):  
        Squared_Error <span style="color:#f92672">+=</span> (actual[i]<span style="color:#f92672">-</span>pred[i])<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">return</span> (Squared_Error<span style="color:#f92672">/</span>actual<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>])<span style="color:#f92672">**</span><span style="color:#ae81ff">0.5</span>     
 
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">RMSE_numpy</span>(actual,pred):
    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>sqrt(np<span style="color:#f92672">.</span>mean((actual<span style="color:#f92672">-</span>pred)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span>timeit RMSE_sklearn(actual,pred,squared<span style="color:#f92672">=</span>False)
<span style="color:#f92672">%</span>timeit RMSE_numpy(actual,pred)
<span style="color:#f92672">%</span>timeit RMSE_numba(actual,pred)
 
<span style="color:#f92672">%</span>memit RMSE_sklearn(actual,pred,squared<span style="color:#f92672">=</span>False)
<span style="color:#f92672">%</span>memit RMSE_numpy(actual,pred)
<span style="color:#f92672">%</span>memit RMSE_numba(actual,pred)
</code></pre></div><table>
<thead>
<tr>
<th>Method</th>
<th style="text-align:center">Time</th>
<th style="text-align:right">Memory Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sklearn</td>
<td style="text-align:center">10.8 ms ± 533 µs</td>
<td style="text-align:right">peak : 488.31 MiB, increment: 15.27 MiB</td>
</tr>
<tr>
<td>Numpy</td>
<td style="text-align:center">8.9 ms ± 491 µs</td>
<td style="text-align:right">peak : 488.31 MiB, increment: 15.27 MiB</td>
</tr>
<tr>
<td>Numba</td>
<td style="text-align:center">1.06 ms ± 35.7 µs</td>
<td style="text-align:right">peak : 250.05 MiB, increment: 0.00 MiB</td>
</tr>
</tbody>
</table>
<h2 id="22-r-squared">2.2 R-Squared</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> r2_score <span style="color:#66d9ef">as</span> R2_sklearn
 
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">R2_numpy</span>(actual,pred):
    avg <span style="color:#f92672">=</span> actual<span style="color:#f92672">.</span>mean()
    SSE <span style="color:#f92672">=</span> ((pred<span style="color:#f92672">-</span>actual)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">.</span>sum()
    SST <span style="color:#f92672">=</span> ((actual<span style="color:#f92672">-</span>avg)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">.</span>sum()
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>SSE<span style="color:#f92672">/</span>SST
 
<span style="color:#a6e22e">@jit</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">R2_numba</span>(actual,pred):
    avg <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    len_array <span style="color:#f92672">=</span> actual<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len_array):
        avg <span style="color:#f92672">+=</span> actual[i]
    avg <span style="color:#f92672">/=</span> len_array
     
    SSE <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    SST <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len_array) :
        SSE <span style="color:#f92672">+=</span> (pred[i]<span style="color:#f92672">-</span>actual[i])<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
        SST <span style="color:#f92672">+=</span> (actual[i]<span style="color:#f92672">-</span>avg)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>SSE<span style="color:#f92672">/</span>SST
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span>timeit R2_sklearn(actual,pred)
<span style="color:#f92672">%</span>timeit R2_numpy(actual,pred)
<span style="color:#f92672">%</span>timeit R2_numba(actual,pred)
 
<span style="color:#f92672">%</span>memit R2_sklearn(actual,pred)
<span style="color:#f92672">%</span>memit R2_numpy(actual,pred)
<span style="color:#f92672">%</span>memit R2_numba(actual,pred)
</code></pre></div><p>Method	Time	Memory Usage
Sklearn	27.7 ms ± 1.59 ms	peak : 480.68 MiB, increment: 7.63 MiB
Numpy	17.7 ms ± 803 µs	peak : 488.31 MiB, increment: 15.27 MiB
Numba	1.42 ms ± 46.8 µs	peak : 473.05 MiB, increment: 0.00 MiB</p>
<table>
<thead>
<tr>
<th>Method</th>
<th style="text-align:center">Time</th>
<th style="text-align:right">Memory Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sklearn</td>
<td style="text-align:center">27.7 ms ± 1.59 ms</td>
<td style="text-align:right">peak : 480.68 MiB, increment: 7.63 MiB</td>
</tr>
<tr>
<td>Numpy</td>
<td style="text-align:center">17.7 ms ± 803 µs</td>
<td style="text-align:right">peak : 488.31 MiB, increment: 15.27 MiB</td>
</tr>
<tr>
<td>Numba</td>
<td style="text-align:center">1.42 ms ± 46.8 µs</td>
<td style="text-align:right">peak : 473.05 MiB, increment: 0.00 MiB</td>
</tr>
</tbody>
</table>
<h1 id="3-linear-regression">3. Linear Regression</h1>
<p>The third section is evaluating those packages on creating a multiple linear regression. Here’s the dummy data I generated by a normal distribution.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">X <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>normal(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,(<span style="color:#ae81ff">100000</span>,<span style="color:#ae81ff">200</span>))
Y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>normal(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,(<span style="color:#ae81ff">100000</span>))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.linear_model <span style="color:#f92672">import</span> LinearRegression <span style="color:#66d9ef">as</span> linreg_sklearn
 
<span style="color:#75715e">#Numpy version</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">least_square_numpy</span>(X,y):
    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>multi_dot([np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>inv(X<span style="color:#f92672">.</span>T<span style="color:#f92672">.</span>dot(X)),X<span style="color:#f92672">.</span>T,y])
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">linreg_numpy</span> :
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>beta <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fit</span>(self,X,y):
        X_with1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>append(np<span style="color:#f92672">.</span>ones((len(X),<span style="color:#ae81ff">1</span>)),X,axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
        self<span style="color:#f92672">.</span>beta <span style="color:#f92672">=</span> least_square_numpy(X_with1,y)
        <span style="color:#66d9ef">return</span> self
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict</span>(self,X):
        X_with1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>append(np<span style="color:#f92672">.</span>ones((len(X),<span style="color:#ae81ff">1</span>)),X,axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
        <span style="color:#66d9ef">return</span> X_with1<span style="color:#a6e22e">@self.beta</span>
<span style="color:#75715e">#Numba version</span>
<span style="color:#a6e22e">@jit</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">inv_nla_jit</span>(A):
    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>inv(A)
 
<span style="color:#a6e22e">@jit</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">nb_dot</span>(A, B):
    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>dot(A,B)
 
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">least_square_numba</span>(X,y):
    inside <span style="color:#f92672">=</span> nb_dot(X<span style="color:#f92672">.</span>T,X)
    outside <span style="color:#f92672">=</span> nb_dot(X<span style="color:#f92672">.</span>T,y)
    <span style="color:#66d9ef">return</span> nb_dot(inv_nla_jit(inside),outside)
 
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">linreg_numba</span> :
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>beta <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fit</span>(self,X,y):
        X_with1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>append(np<span style="color:#f92672">.</span>ones((len(X),<span style="color:#ae81ff">1</span>)),X,axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
        self<span style="color:#f92672">.</span>beta <span style="color:#f92672">=</span> least_square_numba(X_with1,y)
        <span style="color:#66d9ef">return</span> self
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict</span>(self,X):
        X_with1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>append(np<span style="color:#f92672">.</span>ones((len(X),<span style="color:#ae81ff">1</span>)),X,axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
        <span style="color:#66d9ef">return</span> X_with1<span style="color:#a6e22e">@self.beta</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span>timeit linreg_sklearn()<span style="color:#f92672">.</span>fit(X,Y<span style="color:#f92672">.</span>reshape(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>))
<span style="color:#f92672">%</span>timeit linreg_numpy()<span style="color:#f92672">.</span>fit(X,Y<span style="color:#f92672">.</span>reshape(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>))
<span style="color:#f92672">%</span>timeit linreg_numba()<span style="color:#f92672">.</span>fit(X,Y<span style="color:#f92672">.</span>reshape(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>))
 
<span style="color:#f92672">%</span>memit linreg_sklearn()<span style="color:#f92672">.</span>fit(X,Y<span style="color:#f92672">.</span>reshape(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>))
<span style="color:#f92672">%</span>memit linreg_numpy()<span style="color:#f92672">.</span>fit(X,Y<span style="color:#f92672">.</span>reshape(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>))
<span style="color:#f92672">%</span>memit linreg_numba()<span style="color:#f92672">.</span>fit(X,Y<span style="color:#f92672">.</span>reshape(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>))
</code></pre></div><table>
<thead>
<tr>
<th>Method</th>
<th style="text-align:center">Time</th>
<th style="text-align:right">Memory Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sklearn</td>
<td style="text-align:center">999 ms ± 28.2 ms</td>
<td style="text-align:right">911.35 MiB, increment: 305.18 MiB</td>
</tr>
<tr>
<td>Numpy</td>
<td style="text-align:center">330 ms ± 20.2 ms</td>
<td style="text-align:right">760.29 MiB, increment: 153.35 MiB</td>
</tr>
<tr>
<td>Numba</td>
<td style="text-align:center">381 ms ± 10.1 ms</td>
<td style="text-align:right">peak : 762.25 MiB, increment: 155.32 MiB</td>
</tr>
</tbody>
</table>
<h1 id="conclusion">Conclusion</h1>


    <div align="center">
        <img src="https://ik.imagekit.io/pwhcix71iqy/conclusion_2021-02-20_UFaJlnFZz.png" width="100%"> </img>
    </div>

<p>From these 6 experiments, I conclude that :</p>
<ol>
<li>Sklearn is slower than NumPy and Numba. Does that mean we need to ditch Sklearn? Obviously not, since the Sklearn function offers much functionality that I not implement. But if you sure that you don’t need all of those features, then just use Numpy/Numba implementation.</li>
<li>Numba is faster than Numpy for heavy but simple calculations such as addition, subtraction, multiplication, division, etc. I also notice that when using less NumPy code inside the Numba function, the memory it took is drastically lower.</li>
<li>Numpy and Numba have a similar speed for a more complex algorithm. In this kind of situation, I will pick Numpy because it needs less code to write.
This is my first time writing a blog, feel free to leave a comment if you notice some kind of mistake or have some suggestion for me.</li>
</ol>
</article>
    <footer class="post-footer">
      
      <div class="sharing">
        <a class="share share-facebook" target="_blank" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fvinson2233.github.io%2fpost%2ffirst_post%2f" title="Share on Facebook">
          <svg class="icon icon-facebook" fill="currentColor"><use xlink:href="#icon-facebook" /></svg>
        </a>
        <a class="share share-twitter" target="_blank" href="https://twitter.com/intent/tweet/?text=Sklearn%20vs%20Numpy%20vs%20Numba%20speed%20comparison%20%28Evaluation%20metric%20and%20building%20linear%20regression%20model%29&amp;url=https%3a%2f%2fvinson2233.github.io%2fpost%2ffirst_post%2f" title="Share on Twitter">
          <svg class="icon icon-twitter" fill="currentColor"><use xlink:href="#icon-twitter" /></svg>
        </a>
      </div>
    </footer>
  </section>

    <footer class="footer">
  <p>Copyright © 2018-2021 Vinson Ciawandy</p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/huyb1991/hugo-lamp" title="Hugo LAMP" target="_blank">LAMP</a>.</p>
</footer>






  </body>
</html>
